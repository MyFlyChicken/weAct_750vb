CONFIG_BOOT_DELAY=2000
#CONFIG_CONSOLE=n
CONFIG_MCUBOOT_LOG_LEVEL_INF=y
# CONFIG_MCUBOOT_SERIAL=y
# CONFIG_MCUBOOT_SERIAL_DIRECT_IMAGE_UPLOAD=y
CONFIG_BOOT_ERASE_PROGRESSIVELY=y
CONFIG_BOOT_MGMT_ECHO=y
#CONFIG_BOOT_SERIAL_IMG_GRP_IMAGE_STATE=y
#CONFIG_BOOT_SERIAL_IMG_GRP_SLOT_INFO=y
CONFIG_MAIN_STACK_SIZE=10240
CONFIG_HW_STACK_PROTECTION=y
CONFIG_GPIO=y
CONFIG_LOG=y
CONFIG_WATCHDOG=y
CONFIG_ARM_MPU=y
CONFIG_FLASH=y
CONFIG_MINIMAL_LIBC=y
CONFIG_CBPRINTF_NANO=y
CONFIG_LOG_MODE_MINIMAL=y
CONFIG_LOG_DEFAULT_LEVEL=0

CONFIG_SPI=y
CONFIG_FLASH_PAGE_LAYOUT=y
CONFIG_FLASH_MAP=y

# Enable running the application directly from external QSPI (XIP).
# This tells MCUBoot to perform a direct-XIP handoff instead of expecting
# the image to be copied into internal flash. Ensure the application
# partitions (image-0 / image-1 / image-scratch) are present in the
# board devicetree and that the application's build uses the same
# partition offsets (FLASH_LOAD_OFFSET / zephyr,code-partition) so
# the bootloader and application agree on addresses.
CONFIG_MCUBOOT_BOOTLOADER_MODE_DIRECT_XIP=y

# Enable the STM32 QSPI flash driver so MCUBoot can access external QSPI
# when performing image management on the flash device.
CONFIG_FLASH_STM32_QSPI=y

CONFIG_BOOT_MAX_IMG_SECTORS_AUTO=n
# MCUboot 扇区配置
# 计算: 3.5MB / 4KB = 896 扇区
CONFIG_BOOT_MAX_IMG_SECTORS=896

# 如果需要，可以指定擦除块大小
CONFIG_SPI_NOR_FLASH_LAYOUT_PAGE_SIZE=4096

# 调试信息（可选，用于排查问题）
CONFIG_FLASH_LOG_LEVEL_DBG=y
CONFIG_BOOT_BANNER=y
